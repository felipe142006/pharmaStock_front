<app-navbar></app-navbar>

<div class="max-w-screen-xl mx-auto px-4 py-6">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Gestión de Usuarios</h1>
      <p class="text-sm text-gray-500">Administra tus usuarios</p>
    </div>
    <button
      class="inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-white font-semibold shadow hover:bg-emerald-700"
      (click)="openCreate()"
    >
      <i class="fa fa-user-plus mr-2"></i> Nuevo Usuario
    </button>
  </div>

  @if (loading()) {
  <div class="w-full flex items-center justify-center py-16 text-gray-600">
    <i class="fas fa-spinner fa-spin fa-2x"></i>
    <span class="ml-3">Cargando usuarios</span>
  </div>
  } @else { @if (users().length === 0) {
  <div class="text-center text-gray-500 py-8">No hay usuarios registrados.</div>
  } @else {
  <div class="bg-white rounded-xl shadow-sm overflow-hidden">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50 text-gray-600 uppercase text-xs tracking-wider">
        <tr>
          <th class="px-4 py-2 text-left">Nombre</th>
          <th class="px-4 py-2 text-left">Correo</th>
          <th class="px-4 py-2 text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (u of users(); track trackById($index, u)) {
        <tr class="border-b hover:bg-gray-50 transition">
          <td class="px-4 py-2">{{ u.name }}</td>
          <td class="px-4 py-2">{{ u.email }}</td>
          <td class="px-4 py-2 text-center">
            <button
              class="text-blue-600 hover:text-blue-800 mx-1"
              (click)="openEdit(u)"
            >
              <i class="fas fa-edit"></i>
            </button>
            <button
              class="text-red-600 hover:text-red-800 mx-1"
              (click)="deleteUser(u.id)"
              [title]="
                currentUserId() !== null && u.id === currentUserId()
                  ? 'No puedes eliminar tu propia cuenta'
                  : 'Eliminar usuario'
              "
            >
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  } }
</div>

<!-- modal de creacion y edicion -->
<ng-template #userModal>
  <div class="modal-header">
    <h5 class="modal-title text-primary">
      {{ editingUser() ? "Editar Usuario" : "Nuevo Usuario" }}
    </h5>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="closeModal()"
    ></button>
  </div>

  <div class="modal-body">
    <form [formGroup]="form" class="space-y-4">
      <div>
        <label class="block font-medium mb-1"
          >Nombre<small class="text-red-600"> *</small></label
        >
        <input
          formControlName="name"
          type="text"
          class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
          placeholder="Ej: Daniel Torres"
        />
      </div>

      <div>
        <label class="block font-medium mb-1"
          >Correo<small class="text-red-600"> *</small></label
        >
        <input
          formControlName="email"
          type="email"
          class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
          placeholder="Ej: usuario@empresa.com"
        />
      </div>

      @if (!editingUser()) {
      <div>
        <label class="block font-medium mb-1"
          >Contraseña<small class="text-red-600"> *</small></label
        >
        <input
          formControlName="password"
          type="password"
          class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
          placeholder="********"
        />
      </div>
      }
    </form>
  </div>

  <div class="modal-footer flex justify-end space-x-2">
    <button class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
    <button
      class="btn btn-primary flex items-center gap-2"
      (click)="saveUser()"
      [disabled]="form.invalid || formLoading()"
    >
      @if (formLoading()) {
      <i class="fas fa-spinner fa-spin"></i> Guardando... } @else {
      {{ editingUser() ? "Actualizar" : "Crear" }}
      }
    </button>
  </div>
</ng-template>
